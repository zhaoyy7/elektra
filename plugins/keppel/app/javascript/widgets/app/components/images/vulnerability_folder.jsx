import { useState } from "react"
import React from "react"
const VulnerabilityFolder = ({ severity, vulns }) => {
  const [isOpen, setOpen] = useState(false)

  const rows = []
  if (isOpen) {
    //sort vulnerabilities by package name
    const vulnsDisplay = [...vulns]
    vulnsDisplay.sort((vuln1, vuln2) =>
      vuln1.pkg.name.localeCompare(vuln2.pkg.name)
    )

    for (const vuln of vulnsDisplay) {
      const maybeFixedIn = vuln.fixed_in_version
        ? ` (fixed in ${vuln.fixed_in_version})`
        : ""

      rows.push(
        <tr key={rows.length}>
          <td colSpan="2" className="vulnerability">
            <div>
              In{" "}
              <strong>
                {vuln.pkg.name} {vuln.pkg.version}
              </strong>
              {maybeFixedIn + ": "}
              {vuln.links ? (
                <a href={vuln.links} target="_blank" rel="noreferrer">
                  {vuln.name}
                </a>
              ) : (
                vuln.name
              )}
            </div>
            {vuln.description ? (
              <div className="text-muted">{vuln.description}</div>
            ) : null}
          </td>
        </tr>
      )
    }
  }

  return (
    <React.Fragment>
      <tr>
        <td rowSpan={1 + rows.length} className="no-top-border"></td>
        <th
          colSpan="2"
          className="vulnerability-folder"
          onClick={() => setOpen(!isOpen)}
        >
          <i className={`fa fa-fw fa-caret-${isOpen ? "down" : "right"}`} />{" "}
          {vulns.length} vulnerabilities of {severity} severity
        </th>
      </tr>
      {rows}
    </React.Fragment>
  )
}

export default VulnerabilityFolder
